Лабораторна робота №12 Взаємодія з користувачем шляхом механізму введення/виведення

Шестопал Дмитро Олексійович

Вхідні дані:

Файл зі строкою чисел або нічого

Код:
```c
#include "lib.h"
#include <stdbool.h>
#include <stdio.h>
#include <stdlib.h>
#include <time.h>

int main(void) {
 printf("\n\tАвтор: Шестопал Дмитро Олексійович КН922Б.\n\t\tЛабораторна №12.\n\tЗавдання: Визначити зворотню матрицю\n");
 srand((unsigned int)time(NULL));

 size_t size_mat = 0;
 size_t size_arr = 0;
 printf("Give 1 line string of numbers to fill an array.\n");
 char* str = read_input();
 if (str == NULL) {
  printf("No input given, do you want to proceed? (y/n)\n");
  if (prompt_for_input()) {
   str = read_input();
   printf("Give 1 line string of numbers to fill an array.\n");
   if (str == NULL) {
    printf("Empty string or failed to read\n");
    return 0;
   }
  } else {
   return 0;
  }
 }

 double* arr = NULL;
 double** mat_in = NULL;
 double** mat_out = NULL;
 int prec = 2;
 if (parse_string(str, &arr, &size_arr) == false) {
  printf("Nothing was in the string\n");
  destroy_arr((void*)str);
  destroy_arr((void*)arr);
  return 0;
 }
 mat_in = convert_array_to_mat(arr, size_arr, &size_mat);
 mat_out = create_double_mat(size_mat, 0, 0, 0);

 if (is_perfect_square((int)size_arr)) {
  printf("Your matrix:\n");
  print_double_mat(mat_in, size_mat, size_mat, prec);

  if(inverse_mat(mat_in, mat_out, size_mat)){
   printf("Inverse matrix:\n");
   print_double_mat(mat_out, size_mat, size_mat, prec);
  } else {
   printf("Inverse matrix doesn't exist\n");
  }
 } else {
  printf("Amount of numbers is not a perfect square.\nCan't create a 2d matrix.\nHere what closest one looks like:\n");
  print_double_mat(mat_in, size_mat, size_mat, prec);
 }

 destroy_mat((void**)mat_in, size_mat);
 destroy_mat((void**)mat_out, size_mat);
 destroy_arr((void*)arr);
 destroy_arr((void*)str);
 
 return 0;
}
```

1. Ініціалізація розміра матриці та розміра массиву чисел на 0
2. Запитуємо у користувача дати нам строку символів.
3. Ініціалізуємо строку та передаємо управління функції read_input
3.1 Функція створює строку на 8192+1 (для '\0',воно встановлено у функції при створюванні строки) символ 
3.2 За допомогою fscanf зчитуємо 8191 символ або до '\n' якщо меньше ніж 8191 та записуємо у str
3.2.1 Якщо зчитування не вдалося - очищаємо потік, звільняємо пам'ять та повертаємо NULL
3.3 Очищаємо потік на наступні визови
3.4 Рахуємо довжину строки (доки не знайдемо '\0' або '\n')
3.4.1 Якщо довижна строки 0 - звільняємо пам'ять строки та повертаемо NULL
3.4.2 Якщо повернута строка - NULL запутуємо у користувача ще раз.
3.4.3 Якщо знову NULL виводемо повідомлення про пусту строку та закриваємо програму
3.5 Повертаємо вказівник на строку
4. Ініціалізуємо массив чисел, матрицю вводу та виводу у NULL,кількість знаків після коми ставимо на 2.
5. Визиваємо функцію parse_string яка поверне true якщо було знайдено хоча б одна число,інакше - false
5.1 Функція ініціалізує массив слів(строк) у NULL та кількість у 0
5.2 Створює bool флаг has_words та передає управлінная у функцію split_string_into_words
5.2.1 Функція отримує строку,вказівник на массив строк та вказівник на кількість слів.
5.2.2 Створюється локальна змінна word_count яка ініціалізується у 0 так строка роздільників ' \t\n'
5.2.3 Створюється копія строки та токинезується щоб дізнатися кількість слів
5.2.3.1 Якщо кількість слів 0 звільняємо пам'ять та повертаємо NULL
5.2.3 Якщо кількість слів >1 то записуємо кожне слово у свою строку у массиві строк
5.2.4 Звільняємо пам'ять виділено для копії строки та ставимо num_words такий самий як і word_count 
5.3 Передаємо кожне отриманне слово у функцію word_to_double
5.3.1 Функція ініціалізує значення num у 0 а також endptr для використання strtod. Якщо у слові яке отримала функція не буде знайдено жодного числа або знайде 0 - функція поверне 0.
5.3.2 Створюється sanitized_str строка яка отримає відфільтровану строку з функції filter_string
5.3.2.1 filter_string переводить усі символи у нижній регістр
5.3.2.2 заміняє усе що не "-.0123456789e" на ' '
5.3.2.3 компресує строку
5.3.2.4.1.1 якщо у строки немає e то зі перевіряється чи є '-' першим, якщо так то видялються усі окрім першого інакше видаляються усі (зі строкою нічого не буде якщо у неї не було '-')
5.3.2.4.1.2 видаляються усі '.' окрім першої (якщо нема '.' то зі строкою нічого не буде)
5.3.2.4.2.1 якщо у строки є e то зі строки видаляються усі окрім першої e
5.3.2.4.3.1 строки ділиться на 2 до e не включно і від e до кінця
5.3.2.4.4.1 на обидві строки йдуть однакові перевірки на від'ємність (тільки для e-строки перевіряється після е)
5.3.2.4.5.1 у обох строках видаляються усі крапки крім першої (якщо є) та усі мінусі (якщо не перший/перший після е)
5.3.2.4.6.1 строка об'єднується за допомогою strcat (за здалегіть виділяється пам'ять для цього)
5.3.2.5 відфільтрованна строка повертається
5.3.3 з отриманної відфільтрованної строки перевірається чи є там е.
5.3.4.1 якщо нема е то отримана строка одразу перетворюється на число за допомогою strtod
5.3.4.2 якщо є 'е' строка ділиться на 2. до є та після є ('е' видаляється).
5.3.4.3 число num становиться "перша частина * 10^друга частина"
5.3.5 повертається число
5.4 кожне слово записується у массив чисел
5.5 коли закінчуються слова для перетворення size (*size) записується як кількість слів
5.6 функція повертає true що означає що було знайдено хоча б одне число
6. створюються матриці mat_in якак створенна конвертуванням одновимірного массиву у двовимірний та mat_out
7. перевіряється чи є кілкість слів ідеальним квадратом.
7.1 якщо ні то для користувача буде написана матриця з його числами але недостаючи числе у якій будуть записані у 0
8. якщо так то визивається функція інвертування
8.1 функція інвертування перевіряє чи є детермінант матриці достатнь великим щоб продовжити (модуль більший ніж 1e-7). якщо так то продовжуємо, інакше ні, повертаємо false так программа виведе що оберненої матриці не існує
8.2 знайденна матриця записується у mat_out
9. виводиться обернена матриця
10. вихід з программи

Кожна окрема функція яка була використанна має юніт тест та пройшла його.

valgrind log:
==158252== Memcheck, a memory error detector
==158252== Copyright (C) 2002-2022, and GNU GPL'd, by Julian Seward et al.
==158252== Using Valgrind-3.19.0 and LibVEX; rerun with -h for copyright info
==158252== Command: cat ./assets/input.txt
==158252== Parent PID: 158251
==158252== 
==158252== 
==158252== HEAP SUMMARY:
==158252==     in use at exit: 0 bytes in 0 blocks
==158252==   total heap usage: 31 allocs, 31 frees, 135,065 bytes allocated
==158252== 
==158252== All heap blocks were freed -- no leaks are possible
==158252== 
==158252== For lists of detected and suppressed errors, rerun with: -s
==158252== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 0 from 0)

Приклади використання:
1. (За допомгою cat)
$ cat ./assets/input.txt | ./dist/main.bin

        Автор: Шестопал Дмитро Олексійович КН922Б.
                Лабораторна №12.
        Завдання: Визначити зворотню матрицю
Give 1 line string of numbers to fill an array.
Your matrix:
[        5.00   11.00    7.00    2.00    9.00    6.00   ]
[        3.00   12.00    8.00    4.00    1.00   16.00   ]
[       13.00   14.00   10.00   15.00   17.00   18.00   ]
[       19.00   20.00   21.00   22.00   23.00   24.00   ]
[       24.00   26.00   27.00   28.00   29.00   30.00   ]
[       31.00   32.00   32.00   34.00   35.00   36.00   ]

Inverse matrix:
[        0.01    0.00   -0.10    0.76   -1.11    0.46   ]
[        0.03    0.02    0.10   -1.26    0.88    0.04   ]
[        0.03    0.00   -0.20    0.52   -0.22   -0.07   ]
[       -0.14   -0.02    0.12   -1.36    1.19   -0.11   ]
[        0.09   -0.06    0.05    0.45   -0.13   -0.20   ]
[       -0.01    0.05    0.01    0.86   -0.63   -0.04   ]

2. (Прямий ввід від користувача (відформатованний)
└─$ ./dist/main.bin

        Автор: Шестопал Дмитро Олексійович КН922Б.
                Лабораторна №12.
        Завдання: Визначити зворотню матрицю
Give 1 line string of numbers to fill an array.
12 1e23 23.3452e-5 64.283405
Your matrix:
[       12.00   100000000000000008388608.00     ]
[        0.00                         64.28     ]

Inverse matrix:
[       0.00    4283.54 ]
[       0.00      -0.00 ]

3. (Прямий ввід від користувача (невідформатованний)
└─$ ./dist/main.bin                                   

        Автор: Шестопал Дмитро Олексійович КН922Б.
                Лабораторна №12.
        Завдання: Визначити зворотню матрицю
Give 1 line string of numbers to fill an array.
"#ав"а"#!"      фіasd23de 23432e2e. 53.453.2344e23e.2^[[D^[[D^[[D
Your matrix:
[             0.00                             23.00    ]
[       2343200.00      8471766731558807450681344.00    ]

Inverse matrix:
[       -157194300094237664.00  0.00    ]
[                         0.04  0.00    ]
(0 , 23, 23432e2, 53.4532344e23.2 (53.4532344*10^23.2))
